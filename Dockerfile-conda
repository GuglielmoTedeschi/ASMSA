# install all necessary packages in tmp builder image
FROM continuumio/miniconda3 as build

USER root

ENV DEBIAN_FRONTEND=noninteractive 
ENV TZ=Europe/Prague

WORKDIR /tmp
COPY environment.yml .
RUN conda env create -f environment.yml 


# make a jupyterhub instance image
FROM jupyterhub/k8s-singleuser-sample:1.1.3

USER root

COPY --from=build /opt/conda/envs /opt/conda/envs
COPY ./* /tmp

ENV PATH="/opt/conda/envs/pyenv/bin:$PATH"

RUN apt-get update -y && apt-get upgrade -y
RUN apt-get install vim -y

